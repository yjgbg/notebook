## 红黑树的性质

1. 每一个结点要么是红色，要么是黑色。

2. 根结点是黑色的。

3. 所有叶子结点都是黑色的（实际上都是Null指针，下图用NIL表示）。叶子结点不包含任何关键字信息，所有查询关键字都在非终结点上。

4. 每个红色结点的两个子节点必须是黑色的。换句话说：从每个叶子到根的所有路径上不能有两个连续的红色结点

5. 从任一结点到其每个叶子的所有路径都包含相同数目的黑色结点

![红黑树](http://ddrvcn.oss-cn-hangzhou.aliyuncs.com/2019/2/jIzeem.jpg)

### 推论：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。

设x为红黑树中从根到叶子的简单路径中黑节点的个数。

y为红黑树中从根到叶子的简单路径中红节点的个数。

则 0 <= y <=  x - 1

根节点到叶子节点的路径长度为: h = x + y - 1

= 》  x -1 <= h <= 2 x - 2

所以最大值与最小值的比值为：

（2 x - 2) / (x - 1) =  2

证明结束

### 推论   红黑树的树高(h)不大于两倍的红黑树的黑深度(bd)，即h<=2bd

设x为红黑树中从根到叶子的简单路径中黑节点的个数。 x > = 2

y为红黑树中从根到叶子的简单路径中红节点的个数。

上一个证明得：x - 1 < = h < = 2 x - 2

因为 bd = x - 1

=》 bd <= h <= 2bd

### 推论  一棵拥有n个内部结点(不包括叶子结点)的红黑树的树高h<=2 log (n+1)

证明h < = 2 log ( n + 1 ) 即证明 2 ^ (h/2)  <= n + 1.

如果可以证明 n >= 2 ^ bd - 1,则 2 ^ ( h / 2 )必然成立（充分不必要条件） 

数学归纳法：

当h = 0 时，n  = 1， bd = 0， 此时 1 >= 2 ^ 0 -1 = 0 ，成立

假设h = t 时，n(t) >= 2 ^ bd(t) - 1 成立。

则当h = t + 1 时候， n(t+1) = nl + nr + 1 = n(t) + n(t) + 1

 =  2 ^ bd(t) + 2 ^bd(t) - 1 = 2 ^(bd(t) + 1) - 1 >= 2 ^bd(t+1) - 1

即 n(t+1) >= 2 ^(bd(t+1) ) - 1

数学归纳法结束：n >= 2 ^ bd - 1 

于是 2 ^(h / 2 ) <= n + 1

## 红黑树的操作

在红黑树上直接插入或删除会导致不再符合红黑树的性质。恢复红黑树的性质需要O(log n)复杂度的颜色变更和不超过三次的树旋转。虽然插入和删除很复杂，但是操作时间仍可以保持为O(log n) 次。

#### 插入

以二叉查找树的方法增加节点，标记为红色（如果设置为黑色，会导致根到叶子的路径上有一条路上，多出来一个黑节点，这会非常难调整。但是设置为红色，可能会导致出现两个连续红色节点的冲突，那么可以通过颜色调换和树旋转来调整。）

之后进行什么操作取决于附近其他节点的颜色。

- 性质1 与性质3总是保持着
- 性质4 只在增加红色节点，重绘黑色节点为红色，做旋转时受到威胁

- 性质5 在增加黑色节点，重绘红色节点为黑色，旋转时受到威胁

插入数据后可能会有5中情况：

- 情形1：新节点N为位于树的根上，没有父节点。违反了性质2。重新绘制为黑色即可。
- 情形2： 新节点的父节点为黑色。不违反任何性质，不做处理
- 情形3：父节点和叔叔节点为红色（图中插入的是N）（违反性质4）
![红黑树](https://upload.wikimedia.org/wikipedia/commons/c/c8/Red-black_tree_insert_case_3.png)

重绘父亲节点和叔叔节点为黑色（不违反性质4，改为违反性质5），祖父节点为红色（不违反性质5，如果祖父节点为根节点，则违反了性质2，负责违反性质4），并将祖父节点视为当前节点（此时回到情形3或者情形1）

- 情形4： 父节点P是红色，叔叔节点U是黑色或缺少，并且新节点N是父节点P的右子节点而父节点P又是其父节点的左子节点。（违反性质4）

![二叉树](https://upload.wikimedia.org/wikipedia/commons/5/56/Red-black_tree_insert_case_4.png)

左旋（仍然违反性质4，但是已经属于新的情形5）

- 情形5： 父节点P是红色而叔叔节点U是黑色或缺少，并且新节点N是父节点的左子节点而父节点P又是其父节点的左子节点

  ![二叉树](https://upload.wikimedia.org/wikipedia/commons/6/66/Red-black_tree_insert_case_5.png)
